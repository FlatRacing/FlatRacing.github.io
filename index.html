<!DOCTYPE html><html><head><meta charset="utf-8"/><link rel="icon" type="image/png" href="flatracing.png"/><style>@font-face{font-family:"PixelMaster";src:url('PixelMaster.ttf');}body{font-family:"PixelMaster";font-size:1.5em;text-align:center;}#game{display:inline-block;background-color:#ffffff;margin-top:40px;box-shadow:0 0 50px 0 #656565;border-radius:8px;}#head{position:relative;padding-bottom:3px;}#screenAll{display:table;text-align:justify;}#left{width:25%;display:table-cell;padding-left:14px;padding-bottom:12px;text-align:left;vertical-align:top;}#right{width:25%;display:table-cell;padding-right:14px;padding-bottom:12px;text-align:right;vertical-align:top;}#clock{width:25%;display:table-cell;text-align:center;vertical-align:middle;padding-bottom:12px;}#menu{display:none;text-align:center;padding-bottom:9px;color:#919191;}#menu a{display:inline-block;color:black;text-decoration:none;margin:0 5px;}#menu a:hover{text-decoration:underline;}#buttons{display:none;position:absolute;left:10px;color:#919191;}#buttons a{color:black;text-decoration:none;}#buttons a:hover{text-decoration:underline;}#sharing{margin-top:38px;}.twitter-share-button{display:inline-block;vertical-align:bottom;margin-right:15px;}span .fb-share-button{display:inline-block;vertical-align:top;margin-left:15px;}.fb-share-button span, .fb-share-button iframe{width:80px !important;height:20px !important;vertical-align:top;}</style><title>FlatRacing v1.0</title></head><body><div id="fb-root"></div><script>(function(d, s, id){var js, fjs=d.getElementsByTagName(s)[0];if (d.getElementById(id)) return;js=d.createElement(s);js.id=id;js.src="http://connect.facebook.net/en_US/sdk.js#xfbml=1&appId=643746005713643&version=v2.0";fjs.parentNode.insertBefore(js, fjs);}(document, 'script', 'facebook-jssdk'));</script><div id="game"><div id="head"><div id="buttons"><a href="#" id="stop">Menu</a> / <a href="#" id="restart">Restart</a><span id="pauseEntity"> / <a href="#" id="playPause">Pause</a></span></div> FlatRacing <span style="color: #919191;">v1.0</span></div><canvas id="canvas"> Please use <span style="color: #b05f23;">Chrome</span>, <span style="color: #934c93;">Firefox</span>, <span style="color: #3b9bc4;">Opera</span> or <span style="color: #327262;">IE (9, 10, 11)</span> to play. </canvas><div id="screenAll"><div id="left"></div><div id="clock"></div><div id="right"></div></div><div id="menu"><a href="#" id="onePlayer" title="[up], [down], [left], [right]"><span style="color: #b05f23;">One</span> player</a> / <a href="#" id="twoPlayers" title="[e], [d], [s], [f]"><span style="color: #934c93;">Two</span> players</a> / <a href="#" id="howToPlay"><span style="color: #b05f23;">How</span> to <span style="color: #934c93;">play</span></a></div></div><div id="sharing"><a href="https://twitter.com/share" class="twitter-share-button" data-count="none" data-lang="en" data-text="[FUN] http://bit.ly/1ii1odw FlatRacing, a pretty sweet game. #games #javascript" data-url="http://divpuib.github.io" >Tweet</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script><div class="fb-share-button" data-href="http://flatracing.github.io/" data-type="button"></div></div><script type="text/javascript">var MIN_HEIGHT=0,MAX_HEIGHT=300,MIN_WIDTH=0,MAX_WIDTH=700,DEFAULT_COLOR="black",BACKGROUND_COLOR="white",METEOR_STEP=10,METEOR_SIZE=7,METEOR_POOL_LENGTH=20,REMAINS_PER_CRASH=20,DT=1,FLUID_BRAKE=.93,MIN_THRESHOLD=MAX_HEIGHT/3,MAX_THRESHOLD=MAX_HEIGHT,INIT_SUMMIT=25,FLAT_ORANGE="#b05f23",FLAT_PURPLE="#934c93",FLAT_BLUE="#3b9bc4",FLAT_GREEN="#327262",FLAT_GRAY="#494949",KEY_CODES={37:"left",38:"up",39:"right",40:"down",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",
67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z"},KEY_STATUS={};for(code in KEY_CODES)KEY_STATUS[KEY_CODES[code]]=!1;document.onkeydown=function(a){a=a||window.event;a=a.keyCode?a.keyCode:a.charCode;if(KEY_CODES[a])return KEY_STATUS[KEY_CODES[a]]=!0,!1};
document.onkeyup=function(a){a=a||window.event;a=a.keyCode?a.keyCode:a.charCode;if(KEY_CODES[a])return KEY_STATUS[KEY_CODES[a]]=!1};var canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d");canvas.width=MAX_WIDTH;canvas.height=MAX_HEIGHT;ctx.fillStyle=DEFAULT_COLOR;ctx.strokeStyle=DEFAULT_COLOR;var screenAll=document.getElementById("screenAll");screenAll.style.width=MAX_WIDTH+"px";
var screenLeft=document.getElementById("left"),screenRight=document.getElementById("right"),screenClock=document.getElementById("clock"),screenPlayers=[],menu=document.getElementById("menu");menu.style.width=MAX_WIDTH+"px";
var onePlayer=document.getElementById("onePlayer"),twoPlayers=document.getElementById("twoPlayers"),howToPlay=document.getElementById("howToPlay"),buttons=document.getElementById("buttons"),stop=document.getElementById("stop"),playPause=document.getElementById("playPause"),restart=document.getElementById("restart"),pauseEntity=document.getElementById("pauseEntity");
window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}();window.cancelRequestAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}();
function randomIntFromInterval(a,d){return Math.floor(Math.random()*(d-a+1)+a)}function fillStrokeCircle(a,d,c,b,f){a.lineWidth=3.2;a.fillStyle=f;a.beginPath();a.arc(d,c,b,0,2*Math.PI,!0);a.closePath();a.fill();a.stroke();a.fillStyle=DEFAULT_COLOR;a.lineWidth=1}function distanceTwoPoints(a,d,c,b){return Math.sqrt(Math.pow(c-a,2)+Math.pow(b-d,2))}
function printTime(a,d){var c=parseInt(a/60),b=a%60;10>b&&(b="0"+b);d.innerHTML='<span style="color: #919191;">[</span> '+c+":"+b+' <span style="color: #919191;">]</span>'}function fillLine(a,d,c,b,f,e){a.lineWidth=3.6;a.beginPath();a.fillStyle=e;a.beginPath();a.moveTo(d,c);a.lineTo(b,f);a.stroke();a.closePath();a.lineWidth=1}
function detectBrowser(){var a=navigator.userAgent,d,c=a.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(c[1]))return d=/\brv[ :]+(\d+)/g.exec(a)||[],"IE "+(d[1]||"");if("Chrome"===c[1]&&(d=a.match(/\bOPR\/(\d+)/),null!=d))return"Opera "+d[1];c=c[2]?[c[1],c[2]]:[navigator.appName,navigator.appVersion,"-?"];null!=(d=a.match(/version\/(\d+)/i))&&c.splice(1,1,d[1]);return c.join(" ")}
function Remains(){this.vy=this.vx=this.xb=this.xb=this.ya=this.xa=0;this.available=!0;this.color=DEFAULT_COLOR;this.setter=function(a,d){var c=.5>Math.random()?1:-1,b=.5>Math.random()?1:-1;this.vx=c*randomIntFromInterval(5,20);this.vy=b*randomIntFromInterval(5,20);this.available=!1;this.xb=this.xa=a;this.yb=this.ya=d};this.print=function(a){fillLine(a,this.xa,this.ya,this.xb,this.yb,this.color)};this.spread=function(){6>=distanceTwoPoints(this.xa,this.ya,this.xb,this.yb)?(this.xa+=this.vx,this.ya+=
this.vy,this.xb+=this.vx/2,this.yb+=this.vy/2):(this.xa+=this.vx,this.ya+=this.vy,this.xb+=this.vx,this.yb+=this.vy)};this.stop=function(){this.xa=this.xb=this.ya=this.yb=0;this.available=!0}}
function PoolRemains(){this.allRemains=Array(3*REMAINS_PER_CRASH);this.onLine=[];for(var a=0;a<4*REMAINS_PER_CRASH;a++)this.allRemains[a]=new Remains;this.explode=function(a,c){for(var b=this.allRemains.splice(0,REMAINS_PER_CRASH),f=0,e=b.length;f<e;f++)b[f].available=!1,b[f].setter(a,c),this.onLine.push(b[f])};this.switchOff=function(a,c){a.stop();var b=this.onLine.splice(c,1);this.allRemains.push(b[0])};this.spread=function(a){for(a=0;a<this.onLine.length;a++)!1==this.onLine[a].available&&(this.onLine[a].spread(),
this.onLine[a].print(),(this.onLine[a].xb>MAX_WIDTH||this.onLine[a].yb>MAX_HEIGHT||1>this.onLine[a].xb||1>this.onLine[a].yb)&&this.switchOff(this.onLine[a],a))};this.controller=function(a){for(var c=0;c<this.onLine.length;c++)!1==this.onLine[c].available&&(this.onLine[c].spread(),this.onLine[c].print(a),this.onLine[c].xb>MAX_WIDTH||this.onLine[c].yb>MAX_HEIGHT?this.switchOff(this.onLine[c],c):(1>this.onLine[c].xb||1>this.onLine[c].yb)&&this.switchOff(this.onLine[c],c))}}
function Tunnel(a,d,c,b,f,e,g,k,h){this.top=new PieceOfTunnel(a,d,e,0,g,h);this.bottom=new PieceOfTunnel(a,d,MAX_HEIGHT-e,MAX_HEIGHT,k,h);this.vx=d;this.vxMax=c;this.minThreshold=b;this.maxThreshold=f;this.counterPeriod=0;this.poolRemains=new PoolRemains;this.print=function(){this.top.print();this.bottom.print()};this.move=function(a){this.top.move(Math.floor(this.vx));this.bottom.move(Math.floor(this.vx));0==a%900&&this.vx>=this.vxMax&&this.vx--};this.arrange=function(){for(var a=0,b=0;b<this.top.size;b++)0>
this.top.x[b]&&a++;for(b=0;b<this.top.size-a;b++)this.top.x[b]=this.top.x[b+a],this.top.y[b]=this.top.y[b+a],this.bottom.x[b]=this.bottom.x[b+a],this.bottom.y[b]=this.bottom.y[b+a];for(b=this.top.size-a;b<this.top.size;b++)a=this.buildPieces(),this.top.x[b]=b,this.top.y[b]=a[0],this.bottom.x[b]=b,this.bottom.y[b]=a[1]};this.randomPoints=function(){var a=randomIntFromInterval(MAX_WIDTH/6,MAX_WIDTH/2),b=randomIntFromInterval(MIN_HEIGHT,MAX_HEIGHT-this.minThreshold),c=randomIntFromInterval(b+this.minThreshold,
Math.min(MAX_HEIGHT,b+this.maxThreshold));return[[a,b],[a,c]]};this.sinusTechnology=function(a,b,c){var d=b[0],e=b[1];return a<=e?.5*(e-a)*(Math.sin(Math.PI/d*c-Math.PI/2)+1)+a:.5*(a-e)*(Math.sin(Math.PI/d*c+Math.PI/2)+1)+b[1]};this.buildPieces=function(){var a=this.sinusTechnology(this.top.oldSummit,this.top.targetPoint,this.counterPeriod),b=this.sinusTechnology(this.bottom.oldSummit,this.bottom.targetPoint,this.counterPeriod);if(this.counterPeriod<this.top.targetPoint[0])this.counterPeriod++;else{this.top.oldSummit=
this.top.targetPoint[1];this.bottom.oldSummit=this.bottom.targetPoint[1];var c=this.randomPoints();this.top.targetPoint=c[0];this.bottom.targetPoint=c[1];this.counterPeriod=0}return[a,b]};this.controller=function(a,b){this.poolRemains.controller(a);this.print(a);this.move(b);this.arrange()}}
function PieceOfTunnel(a,d,c,b,f,e){this.size=a+1;this.x=Array(this.size);this.y=Array(this.size);this.oldSummit=c;this.targetPoint=[1,c];this.color=f;for(a=0;a<this.size;a++)this.x[a]=a,this.y[a]=c;this.print=function(){e.fillStyle=this.color;e.beginPath();e.moveTo(this.x[0],this.y[0]);for(var a=1;a<this.size;a++)e.lineTo(this.x[a],this.y[a]);e.lineTo(this.x[this.size-1],b);e.lineTo(this.x[0],b);e.lineTo(this.x[0],this.y[0]);e.fill();e.closePath();e.fillStyle=DEFAULT_COLOR;e.lineWidth=3.6;e.beginPath();
e.moveTo(this.x[0],this.y[0]);for(a=1;a<this.size;a++)e.lineTo(this.x[a],this.y[a]);e.stroke();e.closePath();e.lineWidth=1};this.move=function(a){for(var b=0;b<this.size;b++)this.x[b]+=a*DT}}
function Meteor(a,d,c,b,f,e){this.x=a;this.y=d;this.vx=c;this.vy=b;this.size=f;this.color=e;this.available=!0;this.print=function(a){fillStrokeCircle(a,this.x,this.y,this.size,this.color)};this.up=function(){this.y-=this.vy};this.left=function(a){this.x=this.x+a-2};this.launch=function(a){this.available=!1;this.size=METEOR_SIZE;this.x=MAX_WIDTH+this.size;this.y=randomIntFromInterval(a.top.y[a.top.size-1],a.bottom.y[a.bottom.size-1])};this.stop=function(){this.available=!0};this.collisionTunnel=function(a){var b=
Math.round(this.x);if(0<this.x&&this.x<MAX_WIDTH){if(this.y<=a.top.y[b]+this.size||this.y>=a.bottom.y[b]-this.size)return!0}else return!1}}
function MeteorShower(){this.stock=Array(METEOR_POOL_LENGTH);for(var a=0;a<METEOR_POOL_LENGTH;a++)this.stock[a]=new Meteor(0,0,METEOR_STEP,METEOR_STEP,0,FLAT_GRAY);this.onLine=[];this.nbOnline=0;this.switchOn=function(a,c){a.launch(c);var b=this.stock.splice(0,1);this.onLine.push(b[0]);this.nbOnline++};this.switchOff=function(a,c){a.stop();var b=this.onLine.splice(c,1);this.stock.push(b[0]);this.nbOnline--};this.controller=function(a,c,b){8<10*Math.random()&&0==b%30&&this.switchOn(this.stock[0],a);
for(b=0;b<this.onLine.length;b++)if(!1==this.onLine[b].available&&this.onLine[b].x>-this.onLine[b].size){if(this.onLine[b].print(c),this.onLine[b].left(a.vx),this.onLine[b].x>METEOR_SIZE&&this.onLine[b].collisionTunnel(a)){var f=this.onLine[b].x,e=this.onLine[b].y;this.switchOff(this.onLine[b],b);a.poolRemains.explode(f,e)}}else!1==this.onLine[b].available&&this.switchOff(this.onLine[b],b)}}
function Ship(a,d,c,b,f,e,g,k,h,l,m,n,p,q,r,s,t){this.x=a;this.y=d;this.vx=c;this.vy=b;this.vxMax=f;this.vyMax=e;this.ax=g;this.ay=k;this.frictX=h;this.frictY=l;this.r=m;this.color=n;this.lives=p;this.score=0;this.invincibility=!1;this.invincibilityClock=10;this.keyLeft=q;this.keyRight=r;this.keyUp=s;this.keyDown=t;this.poolRemains=new PoolRemains;this.poolFootPrint=Array(20);for(a=0;20>a;a++)this.poolFootPrint[a]=new FootPrint;this.drive=function(a){KEY_STATUS[this.keyLeft]&&(this.timeToPrint(a),
this.vx=this.vx-this.ax*DT>-this.vxMax?this.vx-this.ax*DT:-this.vxMax);KEY_STATUS[this.keyRight]&&(this.timeToPrint(a),this.vx=this.vx+this.ax*DT<this.vxMax?this.vx+this.ax*DT:this.vxMax);KEY_STATUS[this.keyUp]&&(this.timeToPrint(a),this.vy=this.vy-this.ay*DT>-this.vyMax?this.vy-this.ay*DT:-this.vyMax);KEY_STATUS[this.keyDown]&&(this.timeToPrint(a),this.vy=this.vy+this.ay*DT<this.vyMax?this.vy+this.ay*DT:this.vyMax)};this.move=function(){this.x=0>this.vx?this.x+this.vx*DT<MIN_WIDTH+this.r?MIN_WIDTH+
this.r:this.x+this.vx*DT:this.x+this.vx*DT>MAX_WIDTH-this.r?MAX_WIDTH-this.r:this.x+this.vx*DT;this.y=0>this.vy?this.y+this.vy*DT<MIN_HEIGHT+this.r?MIN_HEIGHT+this.r:this.y+this.vy*DT:this.y+this.vy*DT>MAX_HEIGHT-this.r?MAX_HEIGHT-this.r:this.y+this.vy*DT;this.vx*=this.frictX;this.vy*=this.frictY};this.print=function(a){this.invincibility?0<=this.invincibilityClock%10&&3>=this.invincibilityClock%10?fillStrokeCircle(a,this.x,this.y,this.r,BACKGROUND_COLOR):fillStrokeCircle(a,this.x,this.y,this.r,this.color):
fillStrokeCircle(a,this.x,this.y,this.r,this.color)};this.collisionTunnel=function(a,b){if(0<=this.x&&this.x<MAX_WIDTH){var c=Math.round(this.x),d=Math.round(this.x-this.r),e=Math.round(this.x+this.r);this.y<=a.top.y[c]+this.r?(d=(a.top.y[e-1]-a.top.y[d])/(e-d),this.vy=-a.vx,this.vx=a.vx*d,this.y=a.top.y[c]+this.r,this.invincibility||(this.lives--,this.invincibility=!0,b.childNodes[0].innerHTML='Lives : <span style="color: '+this.color+';">'+this.lives+" |</span>",-3>a.vx&&(a.vx+=.25))):this.y>=a.bottom.y[c]-
this.r&&(d=(a.bottom.y[e-1]-a.bottom.y[d])/(e-d),this.vy=a.vx,this.vx=-a.vx*d,this.y=a.bottom.y[c]-this.r,this.invincibility||(this.lives--,this.invincibility=!0,b.childNodes[0].innerHTML='Lives : <span style="color: '+this.color+';">'+this.lives+" |</span>",-3>a.vx&&(a.vx+=.25)))}};this.collisionShip=function(a){for(var b=0,c=a.length;b<c;b++)if(a[b]!=this&&distanceTwoPoints(this.x,this.y,a[b].x,a[b].y)<=this.r+a[b].r){var d=Math.abs(distanceTwoPoints(this.x,this.y,a[b].x,a[b].y)-(this.r+a[b].r)),
e=this.vx/Math.sqrt(this.vx*this.vx+this.vy*this.vy),e=isFinite(e)?e:0;this.x-=d*e*1.5;e=this.vy/Math.sqrt(this.vx*this.vx+this.vy*this.vy);e=isFinite(e)?e:0;this.y-=d*e*1.5;d=a[b].vx;e=a[b].vy;a[b].vx=this.vx;a[b].vy=this.vy;this.vx=d;this.vy=e}};this.collisionMeteor=function(a,b){for(var c=0;c<a.onLine.length;c++)distanceTwoPoints(this.x,this.y,a.onLine[c].x,a.onLine[c].y)<=this.r+a.onLine[c].size&&(a.switchOff(a.onLine[c],c),this.invincibility||(this.lives--,this.invincibility=!0,b.childNodes[0].innerHTML=
'Lives : <span style="color: '+this.color+';">'+this.lives+" |</span>"),this.vx-=6,this.poolRemains.explode(this.x,this.y))};this.scoreCalculator=function(a,b){0==a&&(b.childNodes[1].innerHTML='Score : <span style="color: '+this.color+';">'+this.score+"</span>");0==a%20&&0<this.x&&0<MAX_WIDTH-this.x&&!1==this.invincibility&&(b.childNodes[1].innerHTML='Score : <span style="color: '+this.color+';">'+this.score+"</span>",this.score+=parseInt(10*(10-Math.log(MAX_WIDTH-this.x)/Math.log(MAX_WIDTH)*10)))};
this.checkLives=function(a,b){0==a&&(b.childNodes[0].innerHTML='Lives : <span style="color: '+this.color+';">'+this.lives+" |</span>");return 0>=this.lives?(b.childNodes[2].innerHTML='<span style="color: '+this.color+';">GAME OVER</span>',!1):!0};this.checkInvincibility=function(){this.invincibility&&(0==this.invincibilityClock%180&&(this.invincibility=!1,this.invincibilityClock=0),this.invincibilityClock++)};this.endlight=function(a){this.invincibility||(this.invincibility=!0);0==this.invincibilityClock%
180&&(this.invincibilityClock=0);0==a%6&&this.invincibilityClock++};this.setFootPrint=function(){for(var a=0,b=this.poolFootPrint.length;a<b;a++)if(!0==this.poolFootPrint[a].available){this.poolFootPrint[a].setter(this.x,this.y);break}};this.timeToPrint=function(a){0==a%3&&this.setFootPrint()};this.printController=function(a,b){for(var c=0,d=this.poolFootPrint.length;c<d;c++)!1==this.poolFootPrint[c].available&&(this.poolFootPrint[c].grow(),this.poolFootPrint[c].x+=b/1.5,this.poolFootPrint[c].print(a),
.4>=this.poolFootPrint[c].r&&this.poolFootPrint[c].stop())};this.controller=function(a,b,c,d,e,f,g){this.poolRemains.controller(f);this.drive(d);this.move();this.printController(f,a.vx);this.collisionShip(c);this.collisionTunnel(a,g);this.collisionMeteor(b,g);this.checkInvincibility();this.scoreCalculator(d,g);this.checkLives(d,g);this.print(f)};this.postGameController=function(a,b,c,d,e,f,g){this.printController(f,a.vx);this.endlight(d);this.collisionShip(c);this.print(f)}}
function FootPrint(){this.y=this.x=0;this.r=6;this.color=DEFAULT_COLOR;this.available=!0;this.setter=function(a,d){this.available=!1;this.x=a;this.y=d;this.r=6};this.stop=function(){this.available=!0;this.r=6;this.y=this.x=0};this.print=function(a){fillStrokeCircle(a,this.x,this.y,this.r,this.color)};this.grow=function(){this.r-=.6}}
function Game(a,d){var c=[new Ship(50,MAX_HEIGHT/2,0,0,5,5,.5,.5,FLUID_BRAKE,FLUID_BRAKE,8,FLAT_ORANGE,10,"left","right","up","down"),new Ship(150,MAX_HEIGHT/2,0,0,5,5,.5,.5,FLUID_BRAKE,FLUID_BRAKE,8,FLAT_PURPLE,10,"s","f","e","d")];screenLeft.innerHTML="";screenRight.innerHTML="";screenClock.innerHTML="";pauseEntity.style.display="inline";this.mainClock=0;this.gameDuration=120;this.play=!0;this.IsOver=!1;this.tunnel=new Tunnel(MAX_WIDTH,-2,-10,MIN_THRESHOLD,MAX_THRESHOLD,INIT_SUMMIT,FLAT_GRAY,FLAT_GRAY,
ctx);this.ships=[];this.meteorShower=new MeteorShower;screenPlayers=[];for(var b=0;b<a&&b<c.length;b++)this.ships[b]=c[b];b=0;for(c=this.ships.length;b<c;b++)0==b%2?screenLeft.innerHTML+='<div id="player'+b+'" class="player"><div class="lives"></div><div class="score"></div><div class="gameOver"></div></div>':screenRight.innerHTML+='<div id="player'+b+'" class="player"><div class="lives"></div><div class="score"></div><div class="gameOver"></div></div>';b=0;for(c=this.ships.length;b<c;b++)screenPlayers[b]=
document.getElementById("player"+b);0<this.ships.length?(screenAll.style.display="table",buttons.style.display="block",menu.style.display="none"):(screenAll.style.display="none",buttons.style.display="none",menu.style.display="block");this.findWinner=function(){if(1<this.ships.length){for(var a=0,b=0,c=0,d=this.ships.length;c<d;c++)this.ships[c].invincibility=!0,this.ships[c].invincibilityClock=10,this.ships[c].score>a&&0<this.ships[c].lives&&(b=c,a=this.ships[c].score);screenClock.innerHTML=screenClock.innerHTML+
"<br/><span style=color:"+this.ships[b].color+";> WINNER : PLAYER "+(b+1)+"</span>"}};this.controller=function(){if(this.isOver){d.clearRect(MIN_WIDTH,MIN_HEIGHT,MAX_WIDTH,MAX_HEIGHT);a=0;for(b=this.ships.length;a<b;a++)this.ships[a].postGameController(this.tunnel,this.meteorShower,this.ships,this.mainClock,this.gameDuration,d,screenPlayers[a]);this.tunnel.print(d)}else{d.clearRect(MIN_WIDTH,MIN_HEIGHT,MAX_WIDTH,MAX_HEIGHT);for(var a=0,b=this.ships.length;a<b;a++)this.ships[a].controller(this.tunnel,
this.meteorShower,this.ships,this.mainClock,this.gameDuration,d,screenPlayers[a]);this.tunnel.controller(d,this.mainClock);this.meteorShower.controller(this.tunnel,d,this.mainClock);0==this.mainClock%60&&1<this.ships.length&&(printTime(this.gameDuration,screenClock),this.gameDuration--);-1==this.gameDuration&&(this.isOver=!0,this.findWinner(),pauseEntity.style.display="none");a=0;for(b=this.ships.length;a<b;a++)0>=this.ships[a].lives&&(this.isOver=!0,this.findWinner(),pauseEntity.style.display="none")}this.mainClock++}}
var typeGame=new Game(0,ctx),refMainLoop,play=!0,gameBeing=0;
window.onload=function(){var a=detectBrowser().toLowerCase();if(-1!=a.indexOf("chrome")||-1!=a.indexOf("firefox")||-1!=a.indexOf("opera")||-1!=a.indexOf("ie"))mainLoop(),onePlayer.onclick=function(){launchGame(1);return!1},twoPlayers.onclick=function(){launchGame(2);return!1},howToPlay.onclick=function(){alert("Use your arrow keys to drive your ship. The aim of the game is to increase your score without bumping into the tunnel and the meteors. The more you drive on the right of the screen, the more you increase your score.\n\nIn the 2 players mode, if the countdown terminates before none of the players dies, then the winner is the player with the highest score. Feel free to bump into the other player\u2019s ship to make him die !\n\n- Player 1 : [up], [down], [left], [right]\n- Player 2 : [e], [d], [s], [f]")},stop.onclick=
function(){launchGame(0);return!1},restart.onclick=function(){launchGame(gameBeing);return!1},playPause.onclick=function(){play=!play;playPause.innerHTML=play?"Pause":"Play";return!1};else{var a=document.getElementById("canvas"),d=document.getElementById("menu"),c=document.getElementById("screenAll");d.parentNode.removeChild(d);c.parentNode.removeChild(c);d=document.createElement("div");a.parentNode.replaceChild(d,a);d.style.width=MAX_WIDTH+"px";d.style.height=MAX_HEIGHT+"px";d.style.display="table-cell";
d.style.textAlign="center";d.style.verticalAlign="middle";d.innerHTML='Please use <span style="color: '+FLAT_ORANGE+';">Chrome</span>, <span style="color: '+FLAT_PURPLE+';">Firefox</span>, <span style="color: '+FLAT_BLUE+';">Opera</span> or <span style="color: '+FLAT_GREEN+';">IE (9, 10, 11)</span> to play.'}};function mainLoop(){play&&typeGame.controller();refMainLoop=requestAnimFrame(mainLoop)}
function launchGame(a){gameBeing=a;play=!0;playPause.innerHTML="Pause";cancelRequestAnimFrame(refMainLoop);typeGame=new Game(a,ctx);mainLoop()};</script></body></html>
